!function (a, b) {
    "function" == typeof define && define.amd ? define(["google", "angular"], function (a, c) {
        return b(a, c)
    }) : "object" == typeof exports ? module.exports = b(require("google"), require("angular")) : b(google, angular)
}(this, function (a, b) {
    !function (a) {
        "use strict";
        a.module("LogicifyGMap", [])
    }(b), function (a, b) {
        "use strict";
        b.module("LogicifyGMap").directive("logicifyGmapControl", ["$compile", "$log", "$timeout", function (c, d, e) {
            return {
                restrict: "E", require: "^logicifyGmap", link: function (d, f, g, h) {
                    function i(b, c) {
                        return a.maps.event.addDomListener(m[0], b, function () {
                            var a = arguments, b = this;
                            e(function () {
                                c.apply(b, a)
                            })
                        })
                    }

                    var j = d.$eval(g.controlPosition), k = d.$eval(g.controlIndex), l = d.$eval(g.events), m = b.element(f.html().trim()), n = [];
                    c(m)(d), e(function () {
                        d.$apply()
                    }), d.$on("$destroy", function () {
                        n.forEach(function (b) {
                            a && a.maps && a.maps.event.removeListener(b)
                        })
                    }), m[0].index = k || 0, f.html("");
                    var o = h.getMap();
                    if (!o.controls[j])throw new Error("Position of control on the map is invalid. Please see google maps spec.");
                    o.controls[j].push(m[0]), null != l && b.forEach(l, function (a, b) {
                        "function" == typeof a && n.push(i(b, a))
                    })
                }
            }
        }])
    }(a, b), function (a, b) {
        "use strict";
        b.module("LogicifyGMap").directive("logicifyGmap", ["$compile", "$log", "$timeout", function (c, d, e) {
            return {
                restrict: "E",
                scope: {gmOptions: "&gmOptions", gmReady: "&gmReady", cssOptions: "&cssOptions"},
                controller: function (d, f, g) {
                    var h = this, i = d.gmOptions(), j = d.gmReady(), k = {
                        zoom: 8,
                        center: new a.maps.LatLng(-34.397, 150.644)
                    }, l = d.cssOptions();
                    i = i || {};
                    var m = {height: "100%", width: "100%", position: "absolute"};
                    b.extend(m, l), b.extend(k, i), f.css(m);
                    var n = b.element("<div>");
                    n.css({height: "100%", width: "100%", margin: 0, padding: 0}), f.append(n);
                    var o = new a.maps.Map(n[0], k);
                    return h.getMap = function () {
                        return o
                    }, "function" == typeof j && j(o), o.openInfoWnd = function (a, b, f, g, h) {
                        if (h.apply(g, [b, f]), g.$scope && g.$compiled)e(function () {
                            g.$scope.$apply()
                        }); else {
                            var i = d.$new();
                            i.$infoWND = g, g.$scope = i, e(function () {
                                i.$apply()
                            })
                        }
                        if (g.$compiled !== !0) {
                            var j = c(a.trim())(g.$scope);
                            g.$compiled = !0, g.setContent(j[0])
                        }
                    }, o.closeInfoWnd = function (a, b) {
                        a.$scope && (a.$compiled = !1, a.$scope.$destroy(), delete a.$scope, delete a.$compiled), b.apply(a, [])
                    }, h
                }
            }
        }])
    }(a, b), function (a, b) {
        "use strict";
        b.module("LogicifyGMap").directive("xmlOverlays", ["$timeout", "$log", "$q", "$compile", "$http", "SmartCollection", function (c, d, e, f, g, h) {
            return {
                restrict: "E", require: "^logicifyGmap", link: function (f, i, j, k) {
                    function l(a, c) {
                        var d = {};
                        return b.extend(d, f.parserOptions), d.map = a, d.afterParse = p, d.onAfterCreateGroundOverlay = f.events.onAfterCreateGroundOverlay, d.onAfterCreatePolygon = f.events.onAfterCreatePolygon, d.onAfterCreatePolyLine = f.events.onAfterCreatePolyLine, d.failedParse = q, d.infoWindow = c, d
                    }

                    function m() {
                        return f.$watch("kmlCollection._uid", function (a, b) {
                            (null == a || a != z) && (f.kmlCollection instanceof h || (f.kmlCollection = new h(f.$eval(j.kmlCollection))), z = f.kmlCollection._uid, (f.busy === !0 || y.docs && y.docs.length > 0) && (A.forEach(function (a) {
                                a._abort()
                            }), A.splice(0, A.length), s()), t().then(function () {
                                A.splice(0, A.length)
                            }))
                        })
                    }

                    function n(a) {
                        null != a && w(a).then(function (a) {
                            1 != f.kmlCollection.length && f.fitBoundsAfterAll !== !1 && (f.globalBounds.extend(a.doc[0].bounds.getCenter()), c(function () {
                                f.gMap.fitBounds(f.globalBounds)
                            }, 10))
                        })
                    }

                    function o(a) {
                        s(a)
                    }

                    function p(a, b) {
                        a[0].$uid = (new Date).getTime() + "-index-" + Math.floor(-9 * Math.random()), "function" == typeof f.events.onAfterParse && f.events.onAfterParse(a), b && b.resolve(a)
                    }

                    function q(a, b) {
                        b && b.reject(a), "function" == typeof f.events.onAfterParseFailed && f.events.onAfterParseFailed(a)
                    }

                    function r() {
                        f.globalBounds = new a.maps.LatLngBounds, 1 != f.kmlCollection.length && f.fitBoundsAfterAll !== !1 ? (f.kmlCollection.forEach(function (a) {
                            f.globalBounds.extend(a.doc[0].bounds.getCenter())
                        }), c(function () {
                            f.gMap.fitBounds(f.globalBounds)
                        }, 10)) : f.kmlCollection.length > 0 && f.fitBoundsAfterAll !== !1 && c(function () {
                            f.gMap.fitBounds(f.kmlCollection[0].doc[0].bounds)
                        }, 10)
                    }

                    function s(c) {
                        if (c) {
                            y.hideDocument(c.doc[0]);
                            var d = y.docs.indexOf(c.doc[0]);
                            d > -1 && (delete y.docsByUrl[c.doc[0].baseUrl], y.docs.splice(d, 1), r())
                        } else b.forEach(y.docs, function (a) {
                            y.hideDocument(a)
                        }), y.docs.splice(0, y.docs.length), y.docsByUrl = {}, f.globalBounds = new a.maps.LatLngBounds
                    }

                    function t() {
                        return f.kmlCollection instanceof h ? (f.busy = !0, f.kmlCollection.onAddItem(n), f.kmlCollection.onRemoveItem(o), f.kmlCollection.forEach(function (a) {
                            A.push(w(a))
                        }), e.all(A).then(function (a) {
                            r(), A.splice(0, A.length), f.busy = !1
                        })) : void 0
                    }

                    function u() {
                        "function" == typeof f.onProgress && f.onProgress({
                            total: A.length,
                            done: v(B.RESOLVED),
                            errors: v(B.REJECTED)
                        })
                    }

                    function v(a) {
                        var b = 0;
                        return A.forEach(function (c) {
                            c.$$state.status === a && b++
                        }), b
                    }

                    function w(a) {
                        var b = e.defer(), c = e.defer();
                        b.promise._abort = function () {
                            b.reject(), c.resolve()
                        }, null != a.url ? g.get(a.url, {
                            timeout: c.promise,
                            responseType: "arraybuffer"
                        }).then(function (a) {
                            var c = new Blob([a.data], {type: a.headers()["content-type"]});
                            c.lastModifiedDate = new Date, c.name = "example" + c.lastModifiedDate, x(c, null, b)
                        }) : "String" == typeof a.content ? x(null, a.content, b) : a.file instanceof Blob ? x(a.file, null, b) : d.error("Incorrect file type. Should be an instance of a Blob or String (url).");
                        var f = b.promise.then(function (b) {
                            return a.doc = b, a
                        })["catch"](function (a) {
                        })["finally"](function () {
                            u()
                        });
                        return f
                    }

                    function x(a, b, c) {
                        null == b ? y.parse(a, null, c) : y.parseKmlString(b, null, c)
                    }

                    var y = null;
                    f.kmlCollection = new h(f.$eval(j.kmlCollection));
                    var z = f.kmlCollection._uid;
                    f.events = f.$eval(j.gmapEvents) || {}, f.parserOptions = f.$eval(j.parserOptions) || {}, f.onProgress = f.$eval(j.onProgress), f.fitBoundsAfterAll = f.$eval(j.fitAllLayers);
                    var A = [], B = {PENDING: 0, RESOLVED: 1, REJECTED: 2};
                    f.gMap = k.getMap(), f.infowindow = f.$eval(j.infoWindow), f.collectionsWatcher = m(), f.infowindow && "function" == typeof f.infowindow.$ready ? f.infowindow.$ready(function (a) {
                        y = new geoXML3.parser(l(f.gMap, a)), t()
                    }) : (y = new geoXML3.parser(l(map)), t()), f.$on("$destroy", function () {
                        "function" == typeof f.collectionsWatcher && f.collectionsWatcher(), A.forEach(function (a) {
                            a._abort()
                        })
                    })
                }
            }
        }])
    }(a, b), function (a, b) {
        b.module("LogicifyGMap").service("InfoWindow", ["$log", "$rootScope", "$templateCache", "$timeout", "$http", "$compile", function (b, c, d, e, f, g) {
            function h() {
                function b(a) {
                    var b = c.open;
                    c.open = function (d, e) {
                        h = d, "function" == typeof d.openInfoWnd && d.openInfoWnd(a, d, e, c, b)
                    };
                    var d = c.close;
                    if (c.close = function (a) {
                            h && ("function" == typeof h.closeInfoWnd && a === !0 ? h.closeInfoWnd(c, d) : d.apply(c, []))
                        }, g = !0, e.length > 0) {
                        for (var f = 0; f < e.length; f++)e[f](c);
                        e = []
                    }
                }

                var c = this, e = [], g = !1, h = null;
                c.$ready = function (a) {
                    return g === !0 && a ? void a(c) : void(a && e.push(a))
                }, arguments[0] ? arguments[0].templateUrl ? f.get(arguments[0].templateUrl, {cache: d}).then(function (d) {
                    arguments[0].content = d.data, a.maps.InfoWindow.apply(c, arguments), b(d.data)
                }) : arguments[0].content && (a.maps.InfoWindow.apply(c, arguments), b(arguments[0].content)) : a.maps.InfoWindow.apply(c, arguments)
            }

            return a && (h.prototype = Object.create(a.maps.InfoWindow.prototype), h.prototype.constructor = h), h
        }])
    }(a, b), function (a) {
        "use strict";
        a.module("LogicifyGMap").service("SmartCollection", [function () {
            function a(a) {
                var c = this;
                Array.isArray(a) && a.forEach(function (a, b) {
                    c.push(a)
                }), c._uid = b++;
                var d = [], e = [], f = c.push;
                c.push = function () {
                    var a = Array.prototype.slice.call(arguments), b = f.apply(c, a);
                    return a.forEach(function (a) {
                        d.forEach(function (b) {
                            b.apply(c, [a])
                        })
                    }), b
                };
                var g = c.pop;
                c.pop = function () {
                    var a = Array.prototype.slice.call(arguments), b = g.apply(c, a);
                    return e.forEach(function (a) {
                        a.apply(c, [b])
                    }), b
                };
                var h = c.unshift;
                c.unshift = function () {
                    var a = Array.prototype.slice.call(arguments), b = h.apply(c, a);
                    return a.forEach(function (a) {
                        d.forEach(function (b) {
                            b.apply(c, [a])
                        })
                    }), b
                };
                c.shift;
                c.shift = function () {
                    var a = Array.prototype.slice.call(arguments), b = h.apply(c, a);
                    return e.forEach(function (a) {
                        a.apply(c, [b])
                    }), b
                };
                var i = c.splice;
                c.splice = function () {
                    var a = Array.prototype.slice.call(arguments), b = i.apply(c, a);
                    return b.forEach(function (a) {
                        e.forEach(function (b) {
                            b.apply(c, [a])
                        })
                    }), b
                }, c.removeQuietly = i, c.onRemoveItem = function (a) {
                    "function" == typeof a && e.push(a)
                }, c.onAddItem = function (a) {
                    "function" == typeof a && d.push(a)
                }
            }

            var b = 0;
            return a.prototype = Object.create(Array.prototype), a.prototype.constructor = a, a
        }])
    }(b)
});